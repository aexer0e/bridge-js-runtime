(function(c,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("@swc/wasm"),require("path-browserify"),require("magic-string")):typeof define=="function"&&define.amd?define(["exports","@swc/wasm","path-browserify","magic-string"],p):(c=typeof globalThis!="undefined"?globalThis:c||self,p(c.BridgeSandbox={},c.init,c.pathBrowserify,c.MagicString))})(this,function(c,p,f,y){"use strict";function h(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var w=h(p),v=h(y);function $(o,e,r=0){const a=new v.default(o),u=(t,s,n)=>a.overwrite(t-r,s-r,n),l=(t,s)=>a.slice(t-r,s-r),i=(t,s)=>a.appendRight(t-r,s);return e.forEach(t=>{if(t.type==="ExportDefaultDeclaration")u(t.span.start,t.span.end,`___module.exports.__default__ = ${l(t.decl.span.start,t.decl.span.end)}`);else if(t.type==="ExportDeclaration")u(t.span.start,t.span.end,l(t.declaration.span.start,t.declaration.span.end)),t.declaration.type==="ClassDeclaration"||t.declaration.type==="FunctionDeclaration"?i(t.span.end,`
___module.exports.${t.declaration.identifier.value} = ${t.declaration.identifier.value}`):t.declaration.type==="VariableDeclaration"&&t.declaration.declarations.forEach(s=>{i(t.span.end,`
___module.exports.${s.id.value} = ${s.id.value}`)});else if(t.type==="ImportDeclaration")if(t.specifiers.length===1&&t.specifiers[0].type==="ImportNamespaceSpecifier")u(t.span.start,t.span.end,`const ${t.specifiers[0].local.value} = await ___require(${t.source.raw})`);else{const s=[];t.specifiers.forEach(n=>{n.type==="ImportDefaultSpecifier"?s.push(`__default__: ${n.local.value}`):n.type==="ImportSpecifier"&&s.push(`${n.imported.value}: ${n.local.value}`)}),u(t.span.start,t.span.end,`const {${s.join(", ")}} = await ___require(${t.source.raw})`)}}),a.toString()}class g{constructor(){this.evaluatedModules=new Map,this.baseModules=new Map,this.env={}}async run(e,r={}){return this.env=r,await this.eval(e)}async eval(e,r){const a=this.evaluatedModules.get(e);if(a)return a;const u=f.dirname(e);if(r||(r=await this.readFile(e).catch(()=>{})),!r)throw new Error(`File "${e}" not found`);await w.default;const{type:l,body:i}=p.parseSync(r,{syntax:e.endsWith(".js")?"ecmascript":"typescript",target:"es2022"}),t=i[0].span.start,s=$(r,i,t);let n=s;e.endsWith(".ts")&&(n=p.transformSync(s,{filename:f.basename(e),jsc:{parser:{syntax:"typescript"},target:"es2020"}}).code);const d={exports:{}};try{await this.runSrc(n,Object.assign({},this.env,{___module:d,___require:_=>this.require(_,u)}))}catch(_){throw new Error(`Error in ${e}: ${_}`)}return this.evaluatedModules.set(e,d),d.exports}async require(e,r){const a=this.baseModules.get(e);if(a)return a;if(e.startsWith("https://")){const i=await(await fetch(e)).text();return this.eval(e,i)}e.startsWith(".")&&(e=f.join(r,e));const u=[".ts",".js"];for(const l of u){const i=`${e}${l}`,t=await this.readFile(i).catch(()=>{});if(!!t)return await this.eval(i,t)}throw new Error(`Module "${e}" not found`)}async runSrc(e,r){return new Function(...Object.keys(r),`return (async () => {
${e}
})()`)(...Object.values(r))}}c.Runtime=g,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
