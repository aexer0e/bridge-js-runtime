(function(s,f){typeof exports=="object"&&typeof module!="undefined"?f(exports,require("@swc/wasm-web"),require("path-browserify"),require("magic-string"),require("json5")):typeof define=="function"&&define.amd?define(["exports","@swc/wasm-web","path-browserify","magic-string","json5"],f):(s=typeof globalThis!="undefined"?globalThis:s||self,f(s.BridgeJsRuntime={},s.init,s.pathBrowserify,s.MagicString,s.json5))})(this,function(s,f,d,v,m){"use strict";function _(c){return c&&typeof c=="object"&&"default"in c?c:{default:c}}var y=_(f),$=_(v),g=_(m);function j(c,e,a=0){const i=new $.default(c),u=(t,r,p)=>i.overwrite(t-a,r-a,p),o=(t,r)=>i.slice(t-a,r-a);let n="";return e.forEach(t=>{if(t.type==="ExportDefaultDeclaration")u(t.span.start,t.span.end,`
___module.__default__ = ${o(t.decl.span.start,t.decl.span.end)};`);else if(t.type==="ExportDefaultExpression")u(t.span.start,t.span.end,`
___module.__default__ = ${o(t.expression.span.start,t.expression.span.end)};`);else if(t.type==="ExportDeclaration")u(t.span.start,t.span.end,o(t.declaration.span.start,t.declaration.span.end)),t.declaration.type==="ClassDeclaration"||t.declaration.type==="FunctionDeclaration"?n+=`
___module.${t.declaration.identifier.value} = ${t.declaration.identifier.value};`:t.declaration.type==="VariableDeclaration"&&t.declaration.declarations.forEach(r=>{n+=`
___module.${r.id.value} = ${r.id.value};`});else if(t.type==="ExportNamedDeclaration"){let r="";for(const{orig:p,exported:l}of t.specifiers)l.value==="default"?r+=`
___module.__default__ = ${p.value};`:r+=`
___module.${l.value} = ${p.value};`;u(t.span.start,t.span.end,r)}else if(t.type==="ImportDeclaration")if(t.specifiers.length===1&&t.specifiers[0].type==="ImportNamespaceSpecifier")u(t.span.start,t.span.end,`
const ${t.specifiers[0].local.value} = await ___require(${t.source.raw});`);else{const r=[];t.specifiers.forEach(l=>{l.type==="ImportDefaultSpecifier"?r.push(`__default__: ${l.local.value}`):l.type==="ImportSpecifier"&&(l.imported||(l.imported=l.local),r.push(`${l.imported.value}: ${l.local.value}`))});const p=r.length===0?`
await ___require(${t.source.raw});`:`
const {${r.join(", ")}} = await ___require(${t.source.raw});`;u(t.span.start,t.span.end,p)}}),i.toString()+n}class M{constructor(e){if(this.evaluatedModules=new Map,this.baseModules=new Map,this.env={},e)for(const[a,i]of e)this.registerModule(a,i)}async run(e,a={},i){return this.env=a,await this.eval(e,i)}clearCache(){this.evaluatedModules.clear()}registerModule(e,a){this.baseModules.set(e,a)}async eval(e,a){const i=this.evaluatedModules.get(e);if(i)return i;const u=d.dirname(e),o=e.endsWith(".js")?"ecmascript":"typescript";if(a||(a=await this.readFile(e).catch(()=>{})),!a)throw new Error(`File "${e}" not found`);if(s.loadedWasm===null)throw new Error("You must call initRuntimes() before using the runtime");await s.loadedWasm;let n=f.minifySync(f.transformSync(a,{filename:d.basename(e),jsc:{parser:{syntax:o,preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code,{compress:!1,mangle:!1,format:{beautify:!0}}).code;const{type:t,body:r}=f.parseSync(n,{syntax:o,target:"es2022"}),p=r[0].span.start,l=j(n,r,p),h={};try{await this.runSrc(l,Object.assign({},this.env,{___module:h,___require:w=>this.require(w,u)}))}catch(w){throw new Error(`Error in ${e}: ${w}`)}return this.evaluatedModules.set(e,h),h}async require(e,a){const i=this.baseModules.get(e);if(i)return typeof i=="function"?await i():i;if(e.startsWith("https://")){const n=await(await fetch(e)).text();return await this.eval(e,n)}if(e.startsWith(".")&&(e=d.join(a,e)),e.endsWith(".json")){const o=await this.readFile(e).catch(()=>{});if(o){let n={};try{n=g.default.parse(o)}catch{throw new Error(`File "${e}" contains invalid JSON`)}return{__default__:n,...n}}}const u=[".ts",".js"];for(const o of u){const n=`${e}${o}`;let t=await this.readFile(n).catch(()=>{});if(!!t)return await this.eval(n,t)}throw new Error(`Module "${e}" not found`)}async runSrc(e,a){return new Function(...Object.keys(a),`return (async () => {
${e}
})()`)(...Object.values(a))}}s.loadedWasm=null;function b(c){s.loadedWasm=y.default(c).then(()=>null)}s.Runtime=M,s.initRuntimes=b,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
