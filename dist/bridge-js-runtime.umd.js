(function(r,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("@swc/wasm-web"),require("path-browserify"),require("magic-string"),require("json5")):typeof define=="function"&&define.amd?define(["exports","@swc/wasm-web","path-browserify","magic-string","json5"],p):(r=typeof globalThis!="undefined"?globalThis:r||self,p(r.BridgeJsRuntime={},r.init,r.pathBrowserify,r.MagicString,r.json5))})(this,function(r,p,d,m,v){"use strict";function _(c){return c&&typeof c=="object"&&"default"in c?c:{default:c}}var y=_(p),$=_(m),g=_(v);function M(c,t,a=0){const i=new $.default(c),u=(e,s,f)=>i.overwrite(e-a,s-a,f),l=(e,s)=>i.slice(e-a,s-a);let n="";return t.forEach(e=>{if(e.type==="ExportDefaultDeclaration")u(e.span.start,e.span.end,`
___module.__default__ = ${l(e.decl.span.start,e.decl.span.end)};`);else if(e.type==="ExportDefaultExpression")u(e.span.start,e.span.end,`
___module.__default__ = ${l(e.expression.span.start,e.expression.span.end)};`);else if(e.type==="ExportDeclaration")u(e.span.start,e.span.end,l(e.declaration.span.start,e.declaration.span.end)),e.declaration.type==="ClassDeclaration"||e.declaration.type==="FunctionDeclaration"?n+=`
___module.${e.declaration.identifier.value} = ${e.declaration.identifier.value};`:e.declaration.type==="VariableDeclaration"&&e.declaration.declarations.forEach(s=>{n+=`
___module.${s.id.value} = ${s.id.value};`});else if(e.type==="ExportNamedDeclaration"){let s="";for(const{orig:f,exported:o}of e.specifiers)o.value==="default"?s+=`
___module.__default__ = ${f.value};`:s+=`
___module.${o.value} = ${f.value};`;u(e.span.start,e.span.end,s)}else if(e.type==="ImportDeclaration")if(e.specifiers.length===1&&e.specifiers[0].type==="ImportNamespaceSpecifier")u(e.span.start,e.span.end,`
const ${e.specifiers[0].local.value} = await ___require(${e.source.raw});`);else{const s=[];e.specifiers.forEach(o=>{o.type==="ImportDefaultSpecifier"?s.push(`__default__: ${o.local.value}`):o.type==="ImportSpecifier"&&(o.imported||(o.imported=o.local),s.push(`${o.imported.value}: ${o.local.value}`))});const f=s.length===0?`
await ___require(${e.source.raw});`:`
const {${s.join(", ")}} = await ___require(${e.source.raw});`;u(e.span.start,e.span.end,f)}}),i.toString()+n}const j=typeof process!="undefined"&&process.release.name==="node";class b{constructor(t){if(this.evaluatedModules=new Map,this.baseModules=new Map,this.env={},t)for(const[a,i]of t)this.registerModule(a,i)}async run(t,a={},i){return this.env=a,await this.eval(t,i)}clearCache(){this.evaluatedModules.clear()}registerModule(t,a){this.baseModules.set(t,a)}deleteModule(t){this.baseModules.delete(t)}async eval(t,a){const i=this.evaluatedModules.get(t);if(i)return i;const u=d.dirname(t),l=t.endsWith(".js")?"ecmascript":"typescript";if(a||(a=await this.readFile(t).catch(()=>{})),!a)throw new Error(`File "${t}" not found`);if(r.loadedWasm===null&&!j)throw new Error("You must call initRuntimes() before using the runtime");await r.loadedWasm;let n=p.minifySync(p.transformSync(a,{filename:d.basename(t),jsc:{parser:{syntax:l,preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code,{compress:!1,mangle:!1,format:{beautify:!0}}).code;const{type:e,body:s}=p.parseSync(n,{syntax:l,target:"es2022"}),f=s[0].span.start,o=M(n,s,f),h={};try{await this.runSrc(o,Object.assign({},this.env,{___module:h,___require:w=>this.require(w,u)}))}catch(w){throw new Error(`Error in ${t}: ${w}`)}return this.evaluatedModules.set(t,h),h}async require(t,a){const i=this.baseModules.get(t);if(i)return typeof i=="function"?await i():i;if(t.startsWith("https://")){const n=await(await fetch(t)).text();return await this.eval(t,n)}if(t.startsWith(".")&&(t=d.join(a,t)),t.endsWith(".json")){const l=await this.readFile(t).catch(()=>{});if(l){let n={};try{n=g.default.parse(l)}catch{throw new Error(`File "${t}" contains invalid JSON`)}return{__default__:n,...n}}}const u=[".ts",".js"];for(const l of u){const n=`${t}${l}`;let e=await this.readFile(n).catch(()=>{});if(!!e)return await this.eval(n,e)}throw new Error(`Module "${t}" not found`)}async runSrc(t,a){return new Function(...Object.keys(a),`return (async () => {
${t}
})()`)(...Object.values(a))}}r.loadedWasm=null;function E(c){r.loadedWasm=y.default(c).then(()=>null)}r.Runtime=b,r.initRuntimes=E,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
